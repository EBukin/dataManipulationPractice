<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Eduard Bukin" />

<meta name="date" content="2017-08-23" />

<title>Filtering CT data in R</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cerulean.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-1.1/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-1.1/highlight.js"></script>
<link href="site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-105220597-1', 'auto');
  ga('send', 'pageview');

</script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3,h4",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Trade data sources and practice</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li>
  <a href="00-data-sources.html">
    <span class="fa fa-info"></span>
     
    Trade data sources
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-gear"></span>
     
    Data manipulation practice in R
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">R practice</li>
    <li>
      <a href="01-data-import.html">Loading COMTRADE data in R</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Excercises</li>
    <li>
      <a href="01-load-ct-data-excercise.html">Load data</a>
    </li>
    <li>
      <a href="02-filter-ct-data-excercise.html">Filter data</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Answers</li>
    <li>
      <a href="01-load-ct-data-excercise-answer.html">Load data</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Filtering CT data in R</h1>
<h4 class="author"><em>Eduard Bukin</em></h4>
<h4 class="date"><em>August 23, 2017</em></h4>

</div>


<div id="subsetting-observations-and-variables" class="section level1">
<h1>Subsetting observations and variables</h1>
<p>Main goal of this exersise is to try subsetting observations and variables in the trade data in R. For doing that, use R package <code>dplyr</code> and particularly commands <a href="http://r4ds.had.co.nz/transform.html#filter-rows-with-filter">filter()</a> and <a href="http://r4ds.had.co.nz/transform.html#select-columns-with-select">select()</a>.</p>
<p>Following the previous example, use the same working directory and donwload <a href="https://unfao-my.sharepoint.com/personal/eduard_bukin_fao_org/_layouts/15/guestaccess.aspx?docid=01bedb1cf326148049ab4b5e3f6bcc3cc&amp;authkey=AarI3iY12Uw9QVfQVITPAdU">this data file</a> to the folder <code>02-filter-ct-data</code> whithin your working directory. This data file contains a compress subset of the WTO data for the years 2014-2016, for all countries available in the CT and for all most aggregated comodities listed in the <a href="https://www.wto.org/english/docs_e/legal_e/14-ag_02_e.htm#annI">Annex 1 of the WTO Agreement on Agriculture</a>. We will be using this data in the current and other exersizes.</p>
<p>To load this data into the R session use <code>readr</code> package and the function <code>read_rds()</code>.</p>
<pre class="r"><code>library(tidyverse)
library(readr)
ctData &lt;- read_rds(&quot;02-filter-ct-data/subsetting-data.rds&quot;)</code></pre>
<div id="dplyrfilter" class="section level2">
<h2>dplyr::filter()</h2>
<p>Practicing with the dplyr <code>filter()</code> function.</p>
<p>Here you may need to use datasets available in the <code>tradeAnalysis</code> package together with the <code>dplyr</code> function for data filtering in order to generate the results that are.</p>
<p>Loade <code>tradeAnalysis</code> package and explore built in datasets. Those are:</p>
<ol style="list-style-type: decimal">
<li><code>wtoAgFood</code></li>
<li><code>wtoAgFoodFull</code> What are the difference between the previous one?</li>
<li><code>classes</code></li>
<li><code>reporters</code></li>
<li><code>partners</code></li>
<li><code>regimes</code></li>
<li><code>units</code></li>
</ol>
<p>If any of these datasets is not working try to access to the dataset using the namespace specification such as <code>tradeAnalysis::units</code>.</p>
<pre class="r"><code>library(tradeAnalysis)
tradeAnalysis::units</code></pre>
<pre><code>##    Qty.Unit.Code         Unit
## 1              1            -
## 2              2           m2
## 3              3     1000 kWh
## 4              4            m
## 5              5            u
## 6              6           2u
## 7              7            l
## 8              8           kg
## 9              9        1000U
## 10            10 U (jeu/pack)
## 11            11          12u
## 12            12           m3
## 13            13        carat
##                                    Unit.Description
## 1                                       No quantity
## 2                             Area in square meters
## 3  Electrical energy in thousands of kilowatt-hours
## 4                                  Length in meters
## 5                                   Number of items
## 6                                   Number of pairs
## 7                                  Volume in liters
## 8                               Weight in kilograms
## 9                                 Thousand of items
## 10                               Number of packages
## 11                                   Dozen of items
## 12                           Volume in cubic meters
## 13                                 Weight in carats</code></pre>
<div id="exersize-1." class="section level3">
<h3>Exersize 1.</h3>
<p>Export a timeseries for wheat (HS 1001) import and export values only in 1000 USD from all EU countries to the world for all available years. Save the time series in an object and then in the <code>.csv</code> file.</p>
<p>To see what are the EU countries either use the full list of reporters <code>reporters</code> and manully record all EU countries of substract EU country codes from the output of the function <code>getEU()</code> in the <code>tradeAnalysis</code> package.</p>
<div id="solution" class="section level4">
<h4>Solution</h4>
<pre class="r"><code>ctSubset &lt;- 
  ctData %&gt;% 
  filter(
    Commodity.Code %in% c(&quot;1001&quot;),
    Reporter.Code %in% getEU()$Partner.Code,
    Partner.Code %in% &quot;0&quot;
    )</code></pre>
<pre class="r"><code>write_csv(ctSubset, &quot;02-filter-ct-data/ex1-subset.csv&quot;)</code></pre>
</div>
</div>
</div>
<div id="dplyrselect" class="section level2">
<h2>dplyr::select()</h2>
<p>Practicing with the dplyr <code>select()</code> function.</p>
<p>In order to make results from the Exersize 1 more user friendly, we need to be able to select different set of columns for presentation using <code>dplyr::select()</code> and other “Select helpers” see <code>?everything()</code>.</p>
<div id="exersize-2." class="section level3">
<h3>Exersize 2.</h3>
<p>Use the output of the previous exersize in order to create to objects tables:</p>
<ul>
<li>one with the trade quantities expressed in 1000 MT.</li>
<li>second with the trade values expressed in 1000 USD.</li>
</ul>
<pre class="r"><code>ctSubsetQuant &lt;- 
  ctSubset %&gt;% 
  select(Reporter.Code, Partner.Code, Trade.Flow.Code, 
         Commodity.Code, Netweight..kg.) %&gt;% 
  mutate(Netweight..kg. = Netweight..kg. / 10^6)
ctSubsetVal &lt;- 
  ctSubset %&gt;% 
  select(Reporter.Code, Partner.Code, Trade.Flow.Code, 
         Commodity.Code, Trade.Value..US..) %&gt;% 
  mutate(Trade.Value..US.. = Trade.Value..US.. / 10^3)</code></pre>
<p>Here you need to use datasets available in the <code>tradeAnalysis</code> package together with the <code>dplyr</code> function for data filtering in order to generate the results that are.</p>
</div>
</div>
</div>

<p>Copyright &copy; 2017 Eduard Bukin. All rights reserved.</p>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
